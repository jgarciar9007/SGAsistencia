{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="h4 mb-0"><i class="bi bi-person-lines-fill me-2"></i>Candidatos</h2>
    <a class="btn btn-success" href="{% url 'empleados:candidato_crear' %}">
      <i class="bi bi-plus-lg me-1"></i>Nuevo Candidato
    </a>
  </div>

  <form class="row g-2 mb-3" method="get">
    <div class="col-12 col-md-6">
      <div class="input-group">
        <span class="input-group-text"><i class="bi bi-search"></i></span>
        <input class="form-control" name="q" value="{{ q }}" placeholder="Buscar por nombre, skills, doc...">
      </div>
    </div>
    <div class="col-6 col-md-3">
      <select name="estado" class="form-select" onchange="this.form.submit()">
        <option value="">Todos los estados</option>
        {% for k, v in estados %}
          <option value="{{ k }}" {% if estado == k %}selected{% endif %}>{{ v }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-6 col-md-3">
      <div class="btn-group w-100">
        <button class="btn btn-outline-secondary" type="submit">Buscar</button>
        <a class="btn btn-outline-dark" href="{% url 'empleados:candidato_list' %}">Limpiar</a>
      </div>
    </div>
  </form>

  <div class="card shadow-sm border-0">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="bg-light">
            <tr>
              <th>Nombre</th>
              <th>Doc ID</th>
              <th>Skills</th>
              <th>Titulaciones</th>
              <th>Estado</th>
              <th class="text-end">Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for c in page_obj %}
            <tr>
              <td>
                <div class="fw-bold">{{ c.nombre_completo }}</div>
                <small class="text-muted">{{ c.email }}</small>
              </td>
              <td>{{ c.doc_id }}</td>
              <td><div class="text-truncate" style="max-width: 150px;">{{ c.skills }}</div></td>
              <td><div class="text-truncate" style="max-width: 150px;">{{ c.titulaciones }}</div></td>
              <td>
                {% if c.estado == 'DISP' %}<span class="badge bg-success">Disponible</span>
                {% elif c.estado == 'PROC' %}<span class="badge bg-warning text-dark">En Proceso</span>
                {% elif c.estado == 'DESC' %}<span class="badge bg-secondary">Descartado</span>
                {% elif c.estado == 'CONTR' %}<span class="badge bg-primary">Contratado</span>
                {% else %}{{ c.get_estado_display }}{% endif %}
              </td>
              <td class="text-end">
                <a class="btn btn-sm btn-outline-primary" href="{% url 'empleados:candidato_detalle' c.pk %}">
                  <i class="bi bi-eye"></i>
                </a>
                <a class="btn btn-sm btn-outline-secondary" href="{% url 'empleados:candidato_editar' c.pk %}">
                  <i class="bi bi-pencil"></i>
                </a>
              </td>
            </tr>
            {% empty %}
            <tr><td colspan="5" class="text-center p-4 text-muted">No hay candidatos registrados</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    {% if page_obj.has_other_pages %}
    <div class="card-footer bg-white py-2">
       <!-- Simple Pagination -->
       <nav>
         <ul class="pagination justify-content-center mb-0">
           {% if page_obj.has_previous %}
           <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}&q={{q}}&estado={{estado}}">Anterior</a></li>
           {% endif %}
           <li class="page-item disabled"><span class="page-link">PÃ¡g {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span></li>
           {% if page_obj.has_next %}
           <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}&q={{q}}&estado={{estado}}">Siguiente</a></li>
           {% endif %}
         </ul>
       </nav>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
